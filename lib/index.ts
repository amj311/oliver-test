const ASCII_LOGO = `
████████████████████████████████████████████████████████████████
██╔═══════════════════════════════════════════════════════════██╗
██║...........................................................██║
██║....██████╗.██╗.....██╗██╗...██╗███████╗██████╗............██║
██║...██╔═══██╗██║.....██║██║...██║██╔════╝██╔══██╗...........██║
██║...██║...██║██║.....██║██║...██║█████╗..██████╔╝...........██║
██║...██║...██║██║.....██║╚██╗.██╔╝██╔══╝..██╔══██╗...........██║
██║...╚██████╔╝███████╗██║.╚████╔╝.███████╗██║..██║...........██║
██║....╚═════╝.╚══════╝╚═╝..╚═══╝..╚══════╝╚═╝..╚═╝...........██║
██║...........................................................██║
██║.......................████████╗███████╗███████╗████████╗..██║
██║.......................╚══██╔══╝██╔════╝██╔════╝╚══██╔══╝..██║
██║..........................██║...█████╗..███████╗...██║.....██║
██║..........................██║...██╔══╝..╚════██║...██║.....██║
██║..........................██║...███████╗███████║...██║.....██║
██║..........................╚═╝...╚══════╝╚══════╝...╚═╝.....██║
██║...........................................................██║
████████████████████████████████████████████████████████████████║
  ╚═════════════════════════════════════════════════════════════╝                                                         
`

import childProcess from 'child_process';
import colors from 'colors';
import { expect as oExpect } from './Assertions';
import { getFilesFromDir, TestFilesCompiler, TestFilesRunner } from "./DriverUtils";
import { oTest } from './TestUtils';

const TSC_OUT_DIR = ".ot-tsc-tmp";

export function runTestDir(testDir:string) {
    console.log(colors.green(ASCII_LOGO));

    const rawFiles = getFilesFromDir(testDir,".test.");
    
    const runner = new TestFilesRunner();
    const compiler = new TestFilesCompiler();

    function runTests(testFiles: any) {
        runner.runFiles(testFiles, ()=>{
            childProcess.exec('rm -rf '+TSC_OUT_DIR);
        });
    }

    compiler.compileFiles(rawFiles, TSC_OUT_DIR, runTests);
}

export const test:any = oTest;
export const expect:any = oExpect;